
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Consulta por Cédula (con Google Sheets)</title>
  <script src="https://unpkg.com/tabletop@1.6.0/tabletop.js"></script>
  <style>
    body { font-family: Arial; margin: 2rem; }
    label, input, select, button { display: block; margin: 1rem 0; }
    #resultado { margin-top: 2rem; padding: 1rem; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h2>Consulta por Cédula</h2>

  <label for="departamento">Selecciona tu departamento:</label>
  <select id="departamento">
    <option value="01 Concepción">01 Concepción</option>
    <option value="02 San Pedro">02 San Pedro</option>
    <option value="03 Cordillera">03 Cordillera</option>
    <option value="04 Guairá">04 Guairá</option>
    <option value="05 Caaguazú">05 Caaguazú</option>
    <option value="06 Caazapá">06 Caazapá</option>
    <option value="07 Itapúa">07 Itapúa</option>
    <option value="08 Misiones">08 Misiones</option>
    <option value="09 Paraguari">09 Paraguari</option>
    <option value="10 Alto Paraná">10 Alto Paraná</option>
    <option value="11 Central">11 Central</option>
    <option value="12 Ñeembucú">12 Ñeembucú</option>
    <option value="13 Amambay">13 Amambay</option>
    <option value="14 Canindeyú">14 Canindeyú</option>
  </select>

  <label for="cedula">Ingresa tu cédula:</label>
  <input type="text" id="cedula" placeholder="Ej: 1234567">

  <button onclick="buscar()">Consultar</button>

  <div id="resultado">Esperando búsqueda...</div>

  <script>
    const publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/1t1pSkMdMwgBTfJC8nUTXKvgbiG7CFLyUGHBwNlzvD4w/pubhtml';

    let hojaActiva = "";

    function buscar() {
      const cedula = document.getElementById("cedula").value.trim().replace(/\D/g, "");
      const departamento = document.getElementById("departamento").value.trim();
      hojaActiva = departamento;

      Tabletop.init({
        key: publicSpreadsheetUrl,
        wanted: [departamento],
        callback: function(data, tabletop) {
          const hoja = data[departamento].elements;
          let resultado = "Cédula no encontrada.";
          for (const fila of hoja) {
            const encuestador = (fila['Cédula Encuestador'] || '').replace(/\D/g, "");
            const supervisor  = (fila['Cédula Supervisor'] || '').replace(/\D/g, "");

            if (cedula === encuestador || cedula === supervisor) {
              resultado = `
                <strong>Rol:</strong> ${cedula === encuestador ? 'Encuestador' : 'Supervisor'}<br>
                <strong>Cédula:</strong> ${cedula}<br>
                <strong>Cédula Supervisor:</strong> ${fila['Cédula Supervisor'] || '-'}<br>
                <strong>Descripción:</strong> ${fila['Descripción'] || '-'}<br>
                <strong>Total a pagar:</strong> ₲ ${fila['Total a pagar'] || '0'}<br>
                <strong>IVA 10%:</strong> ₲ ${fila['Iva 10%'] || '0'}<br>
                <strong>Total IVA:</strong> ₲ ${fila['Total IVA'] || '0'}
              `;
              break;
            }
          }
          document.getElementById("resultado").innerHTML = resultado;
        },
        simpleSheet: false
      });
    }
  </script>
</body>
</html>
